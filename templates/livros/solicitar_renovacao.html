{% extends "base.html" %}
{% block title %}Renovar Empréstimo • Biblox{% endblock %}
{% block content %}

<div class="page">

  <div class="grid two" style="grid-template-columns:1fr auto;">
    <h1 class="title">Renovar Empréstimo</h1>
    <a href="{% url 'livros:emprestimos_list' %}" class="btn secondary">← Voltar</a>
  </div>

  <div class="card" style="margin-top:8px;">
    <div class="card-body">
      <div class="grid two">
        <p>
          <strong>Livro</strong><br>
          {{ emprestimo.livro.nome }}
        </p>
        <p>
          <strong>Usuário</strong><br>
          {{ emprestimo.usuario.username }}
        </p>
        <p>
          <strong>Data de saída</strong><br>
          {{ emprestimo.data_saida|date:"d/m/Y" }}
        </p>
        <p>
          <strong>Prevista (atual)</strong><br>
          {{ emprestimo.data_prevista_devolucao|date:"d/m/Y" }}
        </p>
        <p>
          <strong>Renovações feitas</strong><br>
          {{ emprestimo.renovacao_count }}
        </p>
        <p>
          <strong>Status</strong><br>
          {% if emprestimo.data_devolucao %}
            <span class="status disponivel">Devolvido em {{ emprestimo.data_devolucao|date:"d/m/Y" }}</span>
          {% elif emprestimo.dias_atraso > 0 %}
            <span class="status emprestado">{{ emprestimo.dias_atraso }} dia(s) de atraso</span>
          {% else %}
            <span class="status disponivel">Em dia</span>
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  {% if pode %}
    <form method="post" class="card" style="margin-top:12px;">
      <div class="card-body">
        {% csrf_token %}
        <p style="margin-bottom:12px;">
          Confirmar <strong>renovação por +7 dias</strong> a partir da data prevista atual?
        </p>
        <button type="submit" class="btn">Confirmar renovação</button>
        <a href="{% url 'livros:emprestimos_list' %}" class="btn secondary" style="margin-left:8px;">Cancelar</a>
      </div>
    </form>
  {% else %}
    <div class="card" style="margin-top:12px; border:1px solid #fecaca; background:#fff1f2;">
      <div class="card-body">
        <p style="color:#b91c1c; margin:0;">
          <strong>Não é possível renovar:</strong> {{ motivo }}
        </p>
        <div style="margin-top:8px;">
          <a href="{% url 'livros:emprestimos_list' %}" class="btn secondary">Voltar</a>
        </div>
      </div>
    </div>
  {% endif %}

</div>

{% endblock %}
